---
- name: Uploading chart
  copy:
    src: "{{ chart_path }}"
    dest: "{{ workdir.path }}/{{ chart }}"
  when: master is defined and master == "true"
  tags:
    - always

- name: Login
  shell: bx pr login -a https://{{ inventory_hostname }}:8443 --skip-ssl-validation -u {{ kubectl_user }} -p '{{ kubectl_pass }}' -c '{{ icp_account }}'
  when: master is defined and master == "true"
  tags:
    - icp

- name: Loading chart
  shell: bx pr load-helm-chart --archive {{ workdir.path }}/{{ chart }}
  when: master is defined and master == "true"
  tags:
    - icp

- name: Installing chart
  shell: helm install {{ workdir.path }}/{{ chart }} -n {{ namespace }}
  when: master is defined and master == "true"
  tags:
    - helm